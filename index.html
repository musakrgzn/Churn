<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yapay Zeka Müşteri Analizi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 10px; }
        .sonuc-kutusu { display: none; margin-top: 20px; padding: 15px; border-radius: 8px; font-weight: bold; text-align: center; }
        .riskli { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }
        .guvenli { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card p-4">
                <h3 class="text-center mb-4 text-primary">Müşteri Ayrılma (Churn) Tahmini</h3>
                
                <form id="churnForm">
                    <div class="mb-3">
                        <label class="form-label">Aylık Fatura Tutarı (TL)</label>
                        <input type="number" class="form-control" id="fatura" placeholder="Örn: 120" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Toplam Kullanım Süresi (Ay)</label>
                        <input type="number" class="form-control" id="sure" placeholder="Örn: 12" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Sözleşme Türü</label>
                        <select class="form-select" id="sozlesme">
                            <option value="Aylik">Aylık Sözleşme</option>
                            <option value="Yillik">1 Yıllık Taahhüt</option>
                            <option value="Iki_Yillik">2 Yıllık Taahhüt</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">İnternet Altyapısı</label>
                        <select class="form-select" id="internet">
                            <option value="Fiber">Fiber</option>
                            <option value="ADSL">ADSL</option>
                            <option value="Yok">Yok</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Son 1 Ayda Teknik Destek Aradı Mı?</label>
                        <select class="form-select" id="destek">
                            <option value="Evet">Evet</option>
                            <option value="Hayir">Hayır</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 mt-3 fs-5">Yapay Zekaya Sor</button>
                </form>

                <div id="sonucAlani" class="sonuc-kutusu mt-4">
                    <h4 id="tahminMetni"></h4>
                    <p id="ihtimalMetni" class="mb-0"></p>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById("churnForm").addEventListener("submit", async function(event) {
        event.preventDefault(); 

        
        const musteriVerisi = {
            "Aylik_Fatura": parseFloat(document.getElementById("fatura").value),
            "Toplam_Kullanim_Ay": parseInt(document.getElementById("sure").value),
            "Sozlesme_Turu": document.getElementById("sozlesme").value,
            "Internet_Turu": document.getElementById("internet").value,
            "Teknik_Destek_Aramasi": document.getElementById("destek").value
        };

        try {
            
            const response = await fetch("http://127.0.0.1:8000/tahmin_et", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(musteriVerisi)
            });

            const data = await response.json();
            
            
            const sonucAlani = document.getElementById("sonucAlani");
            const tahminMetni = document.getElementById("tahminMetni");
            const ihtimalMetni = document.getElementById("ihtimalMetni");

            sonucAlani.style.display = "block"; 
            
            if (data.Sistem_Tahmini === "Ayrilacak (CHURN)") {
                sonucAlani.className = "sonuc-kutusu riskli";
                tahminMetni.innerText = "⚠️ DİKKAT: Müşteri Ayrılabilir!";
                ihtimalMetni.innerText = "Ayrılma İhtimali: " + data.Ayrilma_Ihtimali;
            } else {
                sonucAlani.className = "sonuc-kutusu guvenli";
                tahminMetni.innerText = "✅ GÜVENLİ: Müşteri Kalacak";
                ihtimalMetni.innerText = "Ayrılma İhtimali: " + data.Ayrilma_Ihtimali;
            }

        } catch (error) {
            alert("API'ye bağlanılamadı. Arka planda FastAPI sunucusunun çalıştığından emin olun!");
        }
    });
</script>

</body>
</html>